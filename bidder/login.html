<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="">
  <title>Bidder Login | NovaBid.market</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body class="text-gray-800 bg-cosmic-50">
  <div id="header-placeholder"></div>

  <!-- Spacer for Fixed Header -->
  <div class="h-16 md:h-20"></div>

  <!-- Login Form Section -->
    <section class="py-20 px-4">
        <div class="max-w-md mx-auto bg-white rounded-2xl shadow-lg p-8 md:p-12 border border-cosmic-100">
            <div class="text-center mb-8">
                <h2 id="form-title" class="text-3xl md:text-4xl font-bold mb-2">Bidder Login</h2>
                <p id="form-subtitle" class="text-gray-600">Access your account to start bidding.</p>
            </div>

            <!-- Login Form -->
            <form id="login-form" method="POST" action="/">
                <input type="hidden" name="csrf_token" class="csrf-token-input" value="">
                <input type="hidden" name="form_type" value="login">
                
                <div class="mb-6">
                    <label for="login-email" class="block text-gray-700 font-medium mb-2">Email Address</label>
                    <input type="email" id="login-email" name="email" class="w-full px-4 py-3 border border-cosmic-200 rounded-lg focus:ring-nova-500 focus:border-nova-500" placeholder="you@example.com" required>
                </div>

                <div class="mb-6">
                    <label for="login-password" class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="login-password" name="password" class="w-full px-4 py-3 border border-cosmic-200 rounded-lg focus:ring-nova-500 focus:border-nova-500" placeholder="••••••••" required>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-nova-500 focus:ring-nova-500 border-gray-300 rounded">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-900">Remember me</label>
                    </div>

                    <div class="text-sm">
                        <a href="#" class="font-medium text-nova-500 hover:text-nova-400">Forgot your password?</a>
                    </div>
                </div>

                <div>
                    <button type="submit" class="w-full bg-cosmic-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-cosmic-700 transition shadow-md">Sign In</button>
                </div>
            </form>

            <!-- Registration Form (Hidden by Default) -->
            <form id="register-form" method="POST" action="/" style="display: none;">
                <input type="hidden" name="csrf_token" class="csrf-token-input" value="">
                <input type="hidden" name="form_type" value="register">
                
                <div class="mb-6">
                    <label for="register-email" class="block text-gray-700 font-medium mb-2">Email Address</label>
                    <input type="email" id="register-email" name="email" class="w-full px-4 py-3 border border-cosmic-200 rounded-lg focus:ring-nova-500 focus:border-nova-500" placeholder="you@example.com" required>
                </div>

                <div class="mb-6">
                    <label for="register-password" class="block text-gray-700 font-medium mb-2">Password</label>
                    <input type="password" id="register-password" name="password" class="w-full px-4 py-3 border border-cosmic-200 rounded-lg focus:ring-nova-500 focus:border-nova-500" placeholder="••••••••" required>
                </div>

                <div class="mb-6">
                    <label for="register-password-confirm" class="block text-gray-700 font-medium mb-2">Confirm Password</label>
                    <input type="password" id="register-password-confirm" name="password_confirm" class="w-full px-4 py-3 border border-cosmic-200 rounded-lg focus:ring-nova-500 focus:border-nova-500" placeholder="••••••••" required>
                </div>

                <div>
                    <button type="submit" class="w-full bg-cosmic-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-cosmic-700 transition shadow-md">Create Account</button>
                </div>
            </form>

            <div class="mt-8 text-center text-sm text-gray-600">
                <p id="toggle-text">Don't have an account? <a href="#" id="toggle-form-link" class="font-medium text-nova-500 hover:text-nova-400">Sign up</a></p>
            </div>
        </div>
    </section>

  <div id="footer-placeholder"></div>

  <script src="/js/script.js"></script>
  <script src="/js/loader.js"></script>
  <script src="/js/common.js"></script>
  <script src="/js/navigation.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/auth.js"></script>
  
  <script>
    // Populate CSRF token from meta tag into all hidden inputs
    (function() {
      const csrfMeta = document.querySelector('meta[name="csrf-token"]');
      if (csrfMeta) {
        const csrfToken = csrfMeta.getAttribute('content');
        const csrfInputs = document.querySelectorAll('.csrf-token-input');
        csrfInputs.forEach(input => {
          input.value = csrfToken;
        });
      }
    })();

    // Toggle between Login and Register forms using event delegation
    (function() {
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const formTitle = document.getElementById('form-title');
      const formSubtitle = document.getElementById('form-subtitle');
      const toggleTextContainer = document.getElementById('toggle-text');
      
      function updateToggleLink(text, linkText) {
        // Clear existing content
        toggleTextContainer.textContent = text + ' ';
        
        // Create and append link element safely
        const link = document.createElement('a');
        link.href = '#';
        link.id = 'toggle-form-link';
        link.className = 'font-medium text-nova-500 hover:text-nova-400';
        link.textContent = linkText;
        toggleTextContainer.appendChild(link);
      }
      
      function toggleForms(e) {
        if (e.target.id === 'toggle-form-link') {
          e.preventDefault();
          
          if (loginForm.style.display === 'none') {
            // Switch to Login
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            formTitle.textContent = 'Bidder Login';
            formSubtitle.textContent = 'Access your account to start bidding.';
            updateToggleLink("Don't have an account?", 'Sign up');
          } else {
            // Switch to Register
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            formTitle.textContent = 'Create Account';
            formSubtitle.textContent = 'Register to start bidding on auctions.';
            updateToggleLink('Already have an account?', 'Sign in');
          }
        }
      }
      
      // Use event delegation on parent container
      toggleTextContainer.addEventListener('click', toggleForms);
    })();

    // Handle login form submission
    (function() {
      const loginForm = document.getElementById('login-form');
      
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        // Attempt login
        const result = login(email, password);
        
        if (result.success) {
          // Show success message
          alert('Login successful! Welcome, ' + result.userData.firstName + '!');
          
          // Redirect to auctions page
          window.location.href = '/bidder/auctions.html';
        } else {
          // Show error message
          alert(result.message);
        }
      });
    })();

    // Check if user is already logged in and redirect
    (function() {
      if (isAuthenticated()) {
        // User is already logged in, redirect to auctions
        window.location.href = '/bidder/auctions.html';
      }
    })();
  </script>
</body>

</html>